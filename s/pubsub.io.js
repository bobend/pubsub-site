(function(s,t){(function(){if(typeof require==="undefined"){var e=function(){},d={},h={};require=function(f){if(arguments.length>1){for(var c=require(arguments[0]),a=1;a<arguments.length;a++)require(arguments[a]);return c}f=f.split("@")[0];if(h[f]&&!d[f]){c=h[f];delete h[f];var b=d[f]=function(){return b.exports};b.browser=!0;b.exports={};c(b,b.exports)}return window[f]||(d[f]||e)()};require.define=function(d,c){h[d]=c}}})();require.define("json-sockets",function(e,d){var h=require("JSON"),f=require("common"),
c=require("curl"),a=function(){},b=function(){var b=function(a){this.host=a};b.prototype.type="ajax";b.prototype.get=function(a,b){this.destroy=c.get(this.host+a,b)};b.prototype.post=function(a,b,g){this.destroy=c.post(this.host+a,b,g)};b.prototype.destroy=a;if(c.cors)return b;b=function(a){this.host=a};b.prototype.type="jsonp";b.prototype.get=function(a,b){this.destroy=c.jsonp(this.host+a+(/\?/.test(a)?"&":"?")+"callback=?",b)};b.prototype.post=function(a,b,g){var d=0,o=this.host+a+(/\?/.test(a)?
"&":"?"),i=this,e=function(){var a=b.length<=(d+1)*1E3?g:f.fork(g,e),m=encodeURIComponent(b.substr(1E3*d++,1E3));i._destroy=c.jsonp(o+"post="+m+"&callback=?",a)};e()};b.prototype.destroy=a;return b}(),g=function(a){a="http://"+(a||window.location.host)+"/json-sockets";return new b(a)},l=f.emitter(function(a){this.reader=g(a);this.writer=g(a);var b=this,c=this.reader,d=this.writer;this.type="longpoll-"+c.type;this.destroyed=!1;this._ping=null;var o=function(){b.destroy()};c.get("/create",f.fork(o,
function(a){var g=[],i=function(g){if(g)for(var g=g.split("\n"),d=0;d<g.length;d++)g[d]&&g[d]!=="pong"&&b.emit("message",h.parse(g[d]));b._ping=setInterval(function(){b._send("ping")},6E4);c.get("/read?id="+a,f.fork(o,i))},e=function(){if(g.length){var a=g.join("\n");g=[];q(a)}else b._send=q},l=function(a){g.push(a)},q=b._send=function(c){b._send=l;d.post("/write?id="+a,c+"\n",f.fork(o,e))};i();b.emit("open")}))});l.prototype.send=function(a){this._send(h.stringify(a))};l.prototype.destroy=function(){if(!this.destroyed)clearInterval(this._ping),
this.destroyed=!0,this.reader.destroy(),this.writer.destroy(),this.emit("close")};l.prototype._send=function(){throw Error("socket is not writable");};var o=f.emitter(function(a){var b=new WebSocket("ws://"+a+"/json-sockets");this._ws=b;var c=this,g;b.onopen=function(){g=setInterval(function(){b.send("ping")},6E4);c.emit("open")};b.onmessage=function(a){a.data!=="pong"&&c.emit("message",h.parse(a.data))};b.onclose=function(){clearInterval(g);c.emit("close")}});o.prototype.type="web-socket";o.prototype.send=
function(a){this._ws.send(h.stringify(a))};var r=window.WebSocket?o:l,q=function(a){document.body?a():(window.addEventListener||window.attachEvent)(window.attachEvent?"onload":"load",a,!1)},k=f.emitter(function(a){var b=this;this.type=r.prototype.type;this._buffer=[];q(function(){var c=b._sock=new r(a);c.on("open",function(){for(;b._buffer.length;)b._send(b._buffer.shift());b.send=b._send;b.emit("open")});c.on("message",function(a){b.emit("message",a)});c.on("close",function(){b.emit("close")})})});
k.prototype.send=function(a){this._buffer.push(a)};k.prototype._send=function(a){this._sock.send(a)};d.connect=function(a){a=a||window.location.host;return new k(a)}});require.define("common",function(e,d){var h=function(){},f;e.browser?(f=function(){this._events={}},f.prototype.on=f.prototype.addListener=function(c,a){this.emit("newListener",c,a);(this._events[c]=this._events[c]||[]).push(a)},f.prototype.once=function(c,a){var b=this,g=function(){b.removeListener(c,a);a.apply(this,arguments)};g.listener=
a;this.on(c,g)},f.prototype.emit=function(c){var a=this._events[c];if(a)for(var b=Array.prototype.slice.call(arguments,1),a=a.slice(),g=0;g<a.length;g++)a[g].apply(null,b)},f.prototype.removeListener=function(c,a){var b=this._events[c];if(b){for(var g=0;g<b.length;g++)if(b[g]===a||b[g].listener===a){b.splice(g,1);break}b.length||delete this._events[c]}},f.prototype.removeAllListeners=function(c){arguments.length?delete this._events[c]:this._events={}},f.prototype.listeners=function(c){return this._events[c]||
[]}):f=require("events").EventEmitter;Object.create=Object.create||function(c){var a=function(){};a.prototype=c;return new a};d.extend=function(c,a){var b=function(){c.call(this);a.apply(this,arguments)};b.prototype=Object.create(c.prototype);return b};d.createEmitter=function(){return new f};d.emitter=function(c){return d.extend(f,c)};d.fork=function(c,a){return function(b,g){b?c(b):a(g)}};d.step=function(c,a){var b=0,g=0,d=0,o=!1,e={},f=null,k=!1,i=function(m,p){if(m&&!o)o=!0,(a||h).apply(e,[m]);
else if(!(o||b&&!(k&&g>=b))){var n=c[d++],j=n.length===1?[i]:[p,i];b=g=0;f=[];k=!1;n.apply(e,d<c.length?j:[p]);k=!0;b&&k&&g>=b&&i(null,f)}};i.parallel=function(){var a=b++;if(k)throw Error("next.parallel must not be called async");return function(b,c){g++;f[a]=c;i(b,f)}};i()};d.memoizer=function(c){var a={},b=function(a){var c=typeof a;if(c!=="object")return c+": "+a;var c=[],d;for(d in a)c.push(b(a[d]));return c.sort().join("\n")};return function(){for(var d="",e=0;e<arguments.length;e++)d+=b(arguments[e])+
"\n";a[d]=a[d]||c.apply(null,arguments);return a[d]}};d.curry=function(c){var a=Array.prototype.slice.call(arguments,1);return function(){return c.apply(this,a.concat(Array.prototype.slice.call(arguments)))}};d.once=function(c){var a=!0;return function(){if(a)return a=!1,(c||h).apply(null,arguments),!0;return!1}};d.future=function(){var c={},a=[];c.get=function(b){a.push(b)};c.put=function(b,d){for(c.get=function(a){a(b,d)};a.length;)a.shift()(b,d)};return c};d.encode=function(){return function(c){return c<
62?"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(c):d.encode(Math.floor(c/62))+"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(c%62)}}();d.uuid=function(){var c=0;return function(){for(var a="",b=0;b<36;b++)a+=d.encode(Math.floor(Math.random()*62));return a+"-"+d.encode(c++)}}();d.gensym=function(){var c=0;return function(){return"s"+c++}}();d.format=function(c,a){a=typeof a==="object"?a:Array.prototype.slice.call(arguments,1);return c.replace(/\{([^{}]+)\}/gm,
function(b,c){return a[c]===void 0?b:a[c]})};d.log=function(){var c=d.format.apply(d,arguments);(typeof window==="undefined"||window.console)&&console.log(c)}});require.define("JSON",function(){typeof JSON==="undefined"&&(JSON={});(function(){function e(a){return a<10?"0"+a:a}function d(a){c.lastIndex=0;return c.test(a)?'"'+a.replace(c,function(a){var b=g[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function h(c,g){var e,f,i,m,p=a,n,j=g[c];
j&&typeof j==="object"&&typeof j.toJSON==="function"&&(j=j.toJSON(c));typeof l==="function"&&(j=l.call(g,c,j));switch(typeof j){case "string":return d(j);case "number":return isFinite(j)?String(j):"null";case "boolean":case "null":return String(j);case "object":if(!j)return"null";a+=b;n=[];if(Object.prototype.toString.apply(j)==="[object Array]"){m=j.length;for(e=0;e<m;e+=1)n[e]=h(e,j)||"null";i=n.length===0?"[]":a?"[\n"+a+n.join(",\n"+a)+"\n"+p+"]":"["+n.join(",")+"]";a=p;return i}if(l&&typeof l===
"object"){m=l.length;for(e=0;e<m;e+=1)typeof l[e]==="string"&&(f=l[e],(i=h(f,j))&&n.push(d(f)+(a?": ":":")+i))}else for(f in j)Object.prototype.hasOwnProperty.call(j,f)&&(i=h(f,j))&&n.push(d(f)+(a?": ":":")+i);i=n.length===0?"{}":a?"{\n"+a+n.join(",\n"+a)+"\n"+p+"}":"{"+n.join(",")+"}";a=p;return i}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+
":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a,b,g={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},
l;if(typeof JSON.stringify!=="function")JSON.stringify=function(c,d,e){var g;b=a="";if(typeof e==="number")for(g=0;g<e;g+=1)b+=" ";else typeof e==="string"&&(b=e);if((l=d)&&typeof d!=="function"&&(typeof d!=="object"||typeof d.length!=="number"))throw Error("JSON.stringify");return h("",{"":c})};if(typeof JSON.parse!=="function")JSON.parse=function(a,b){function c(a,d){var e,g,f=a[d];if(f&&typeof f==="object")for(e in f)Object.prototype.hasOwnProperty.call(f,e)&&(g=c(f,e),g!==void 0?f[e]=g:delete f[e]);
return b.call(a,d,f)}var d,a=String(a);f.lastIndex=0;f.test(a)&&(a=a.replace(f,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),typeof b==="function"?c({"":d},""):d;throw new SyntaxError("JSON.parse");}})()});require.define("curl",function(e,d){typeof XMLHttpRequest==
"undefined"&&(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(b){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(c){}throw Error("This browser does not support XMLHttpRequest.");});var h=function(){},f=[],c=function(a,b,c,d){var e=f.length?f.pop():new XMLHttpRequest,r=function(){f.push(e);d(!/2\d\d/.test(e.status)&&Error("invalid status="+e.status),e.responseText)};e.open(a,b,!0);e.onreadystatechange=
function(){if(e.readyState===4)e.onreadystatechange=h,setTimeout(r,1)};e.send(c);return function(){e.onreadystatechange=h;e.abort();d(Error("request aborted"))}};d.cors="withCredentials"in new XMLHttpRequest;d.get=function(a,b){return c("GET",a,null,b)};d.post=function(a,b,d){typeof b==="function"&&(d=b,b=null);return c("POST",a,b,d||h)};d.jsonp=function(){var a=window._tmp_jsonp={},b="cb"+(new Date).getTime(),c=0,d=function(a,b){window.attachEvent?window.attachEvent("on"+a,b):window.addEventListener(a,
b,!1)};return function(e,f,q){typeof f==="function"&&(q=f,f={});var f=f||{},q=q||h,k=b+c++,i=!1,m=function(b,c){i=!0;var d=document.getElementById(k);if(d)d.onreadystatechange=h,d.parentNode.removeChild(d);delete a[k];q(b,c)};a[k]=function(a){if(f.strict&&(a===void 0||a===null||a.error)){var b=Error(a&&a.error||"result is undefined or null");if(a)for(var c in a)b[c]=a[c];m(b)}else m(null,a)};var e=e.replace(/(\?|\&)(callback|jsonp)=\?/,"$1$2=_tmp_jsonp."+k),p=function(){if(!i){var a=document.createElement("script");
a.async=!0;a.src=e;a.id=k;document.body.appendChild(a)}};document.body||f.async?document.body?p():d("load",p):document.write(unescape("%3Cscript")+' src="'+e+'" id="'+k+'"'+unescape("%3E%3C/script%3E"));document.getElementById(k).onreadystatechange=function(){i||this.readyState!=="loaded"&&this.readyState!=="complete"||m(Error("jsonp request failed"))};return function(){m(Error("jsonp request was cancelled"))}}}()});var v=require("json-sockets"),w=require("common"),x=function(){},y=function(e){if(e&&
typeof e==="object")return e;e=((e||"").match(/([^:\/]*)(?::(\d+))?(?:\/(.*))?/)||[]).slice(1);return{host:e[0]||"localhost",port:parseInt(e[1]||(s.browser?80:10547),10),sub:e[2]||"/"}},u=function(e){for(var d in e)Object.prototype.toString.call(e[d])==="[object RegExp]"?e[d]={$regex:""+e[d]}:typeof e==="object"&&(e[d]=u(e[d]));return e};t.connect=function(e){var e=y(e),d=v.connect(e.host+":"+e.port),h={},f={};d.send({sub:e.sub});d.on("message",function(c){c.name==="publish"&&(f[c.id]||x)(c.doc)});
h.subscribe=function(c,a,b){b||(b=a,a=void 0);var e=w.gensym();f[e]=b;d.send({name:"subscribe",id:e,query:u(c),selection:a});return function(){delete f[e];d.send({name:"unsubscribe",id:e})}};h.publish=function(c,a){d.send({name:"publish",doc:c,challenge:a})};return h};if(!s.browser){var z=require("signer");t.signer=function(){return function(e){var d={},h;for(h in e)d[h]={$signed:z.sign(h.replace(/\//g,"-")+"/"+e[h]),value:e[h]};return d}}}})({browser:!0},window.pubsubio={});